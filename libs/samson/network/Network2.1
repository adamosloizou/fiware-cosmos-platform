Plan for Network 2.1
===============================================================================

o Ports
  The worker could open up one port for delilahs and another port for workers.
  If the info in the Hello message mismatches regarding the peer type, the connection
  would be closed immediately.
  Will any other connections be needed?
  Except port 80 for REST, of course ...

o /var/samson/etc/clusterInfo
  Binary file (at least to start with) that contains:
    - Cluster Id
    - Cluster Version (number of updates to cluster)
    - Number of workers in cluster
    - Vector of workers
      - ip
      - perhaps nothing more is needed ... ?
    The workers (and delilah also) need to be able to update the clusterInfo file


o Delilah commands
  - add_node
  - remove_node
  - cluster_reset


o Adding and removing nodes to a cluster
  Done in delilah.
  - Adding a node to a cluster
    When a worker receives a 'Join Cluster' from a delilah, the Network layer needs to ask lower layers
    if the worker is really ready to join a cluster.
    If not in 'Unclustered' the request will be immediately rejected.
    After adding a node to a cluster, delilah will send the clusterInfo to all nodes in the cluster.
  
  - Removing a node from a cluster
    Should we implement this?  The worker can be killed and then started with '-reset'.
    But, as we know immediately that a node is to leave a cluster, we'll get better tput.
    No need for the platform to 'guess' when we already have this information.
    So, delilah asks a worker to step out of a cluster and if the worker agrees (lower layers will tell),
    the worker enters 'Unclustered' and delilah sends the new clusterInfo to all workers.

  - Resetting a cluster
    Just remove the nodes, one after the other


o Command line options
  - reset:          delete $SAMSON_WORKING/etc/clusterInfo
  - anything else?


o Added fields for the Hello message
  - Cluster Id
  - Cluster Version
  - Number of workers
  - Vector of workers
    - just IP ?
    - Current state?
  Must say I don't really like to include the whole vector of workers in the Hello message.
  But, it simplifies things, so we'll do it that way ...
  In 'Phase II', when everything else is working, these messages will be using GPB.
  Not before everything is working, as GPB makes it a whole lot harder for my debugging ...


o Startup Cases
  1. With 'etc/clusterInfo'
     Worker tries to connect to each and every one of the workers in the file
     If the clusterVersion isn't the same, the connection will be  rejected
     If the new worker is able to connect to a mayority of the workers, it 
     stays in the cluster. If not, it deletes the file and enters 'Unclustered' mode.

  2. Without 'etc/clusterInfo' (or with '-reset' option)
     The worker simply enters 'Unclustered' mode, and awaits delilah to connect and
     give instructions. Connections from other workers are rejected.
     Well, they are accepted but after the Hello is exchanged and the unclustered 
     worker finds out that the other side is not a delilah, the connection in rejected.
     Here, if we decline for using different ports, the worker wouldn't open the port
     for workers until delilah has told the worker in what mode to operate.


o Worker modes
  - Unclustered
    In unclustered mode, the worker only accepts connections from delilahs.
    If delilah sends a 'Join Cluster' before any job is initiated, the worker
    will try to join the cluster. Otherwise, the worker enters 'Standalone' mode
    and the 'Join Cluster' message will be rejected.
    The low level parts of the samson platform takes care of knowing when to
    enter 'Standalone' mode. Network2.1 knows when to enter 'Clustered' mode.
    If the worker is unable to connect to the cluster it stays in 'Unclustered' mode.

  - Clustered
    In this mode, the worker is working normally and if any worker is disconnected, it
    tries to reconnect to the worker if its 'worker index' is higher.
    The worker cannot be taken out of clustered mode. It must be killed manually and
    started with the 'reset' option - which makes the worker to delete the etc/clusterInfo file.

  - Standalone (which is just a special case of 'Clustered')
    Worker is working normally and cannot be taken out of this state.
    Must be killed and restarted


o Implementation Order
  1. Use blocks for reads and writes, closer to samson platform ...
  2. Network Interface changes
  3. Better callbacks for worker connection/disconnection
  4. Change Hello
  5. ...
 99. Use Google Protocol Buffers instead of proprietary protocol
