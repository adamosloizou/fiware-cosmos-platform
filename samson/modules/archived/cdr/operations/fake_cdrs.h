/*
 * Telefónica Digital - Product Development and Innovation
 *
 * THIS CODE AND INFORMATION ARE PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND,
 * EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR PURPOSE.
 *
 * Copyright (c) Telefónica Investigación y Desarrollo S.A.U.
 * All rights reserved.
 */

/**
 File autogenerated with samsonModuleParser. Please, edit to complete this operation
*/

#ifndef _H_SAMSON_cdr_sna_fake_cdrs
#define _H_SAMSON_cdr_sna_fake_cdrs


#include <samson/module/samson.h>


namespace samson{
namespace cdr{


	class fake_cdrs : public samson::Generator
	{
		samson::system::UInt id;
		samson::cdr::CDR cdr;

	public:


		void run( samson::KVWriter *writer )
		{
			int num_nodes			= environment->getInt( "cdr.fake.users" ,  1000 );
			int num_links_per_node	= environment->getInt( "cdr.fake.nodes_per_link" ,  30 );
			
			for (int i = 0 ; i < num_nodes ; i++)
			{
				for (int j = 0 ; j < num_links_per_node ; j++)
				{
					id = i+1;
					
					//Get a different link
					
					do{
						cdr.node = (rand()%num_nodes)+1;
					} while( cdr.node == id );	//Make sure we are not autolinked
					
					for (int k = 0 ; k < rand()%10 ; k++)
					{
						cdr.date.day.value	= rand()%30;
						cdr.date.month.value	= rand()%12;
						cdr.date.year.value	= 10;
						cdr.date.week_day.value = rand()%7;
						cdr.date.week_day_SetAssigned(true);
						
						cdr.time.hour.value = rand()%23;
						cdr.time.minute.value = rand()%60;
						
						cdr.duration = rand()%100;
						
						writer->emit(0,&id, &cdr);
						
						if( (rand()%10) <= 2)
							writer->emit(0,&id, &cdr);	//Duplicated
						
						
					}
				}
			}
			
		}


	};


} // end of namespace samson
} // end of namespace cdr

#endif
