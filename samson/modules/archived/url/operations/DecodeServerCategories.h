/*
 * Telefónica Digital - Product Development and Innovation
 *
 * THIS CODE AND INFORMATION ARE PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND,
 * EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR PURPOSE.
 *
 * Copyright (c) Telefónica Investigación y Desarrollo S.A.U.
 * All rights reserved.
 */

/**
 File autogenerated with samsonModuleParser. Please, edit to complete this operation
*/

#ifndef _H_SAMSON_url_DecodeServerCategories
#define _H_SAMSON_url_DecodeServerCategories


#include <samson/module/samson.h>


/*********************************************************
reduce DecodeServerCategories
{
	in system.UInt system.String	      # Server(id) - Server(string) to decode the server information
	in system.UInt url.CategoryVector     # Server(id) - CategoryVector (averaged through servers)
	out system.String url.CategoryVector  # Server(string) - CategoryVector

	helpLine "Decode the list of servers to string, with category distribution"
}
**********************************************************/

namespace samson{
namespace url{


	class DecodeServerCategories : public samson::Reduce
	{

	public:
		samson::system::String serverStr;
		CategoryVector categories;


		void run(  samson::KVSetStruct* inputs , samson::KVWriter *writer )
		{
			if (inputs[1].num_kvs == 0)
			{
				return;
			}

			if (inputs[0].num_kvs != 1)
			{
				samson::system::UInt serverId;
				serverId.parse(inputs[1].kvs[0]->key);
				OLM_E(("We should have one and only one occurrence of servers in decoding server list. inputs[0].num_kvs: %d", inputs[0].num_kvs));
			}

			serverStr.parse(inputs[0].kvs[0]->value);
			categories.parse(inputs[1].kvs[0]->value);

			writer->emit(0, &serverStr, &categories);
		}


	};


} // end of namespace samson
} // end of namespace url

#endif
