#
# Start samsonWorker
#

#
# delilah -f ... (get quijote)
#
# shell> cat trunk/modules/core/txt/testing/quijote.txt | samsonPush quijote
# delilah> run_stream_operation txt.parser_words quijote quijote.words
# delilah> run_stream_operation txt.word_count quijote.words quijote.count



#
# Is the worker alive?
#
curl localhost:9898/samson/version.json > json/version.json 2> /dev/null
if [ "$?" != "0" ]
then
    echo samsonWorker doesn\'t respond ...
    exit 1
fi


mkdir xml
mkdir json

# JSON Errors:
curl localhost:9898/simpson.json                            > json/error_no_family.json  2> /dev/null
curl localhost:9898/simpson/version.json                    > json/error_bad_family.json  2> /dev/null
curl localhost:9898/samson/simpson.json                     > json/error_bad_command.json  2> /dev/null
curl localhost:9898/simpson/version/34.json                 > json/error_version_34.json  2> /dev/null
curl localhost:9898/samson/state/qnotfound/k.json           > json/error_state_not_found.json  2> /dev/null
curl localhost:9898/samson/state/qnotfound.json             > json/error_state_no_key.json  2> /dev/null
curl localhost:9898/samson/queue/qnotfound/k.json           > json/error_queue_not_found.json  2> /dev/null
curl localhost:9898/samson/queue/qnotfound.json             > json/error_queue_no_key.json  2> /dev/null
curl localhost:9898/samson/state/quijote.count/XXXXYZ.json  > json/state_quijote_XXXXYZ.json  2> /dev/null
curl localhost:9898/samson/queue/quijote.count/XXXYZ.json   > json/queue_quijote_XXXXYZ.json  2> /dev/null
curl localhost:9898/samson/logging.json                     > json/error_logging.json  2> /dev/null
curl localhost:9898/samson/logging/xxx.json                 > json/error_logging_xxx.json  2> /dev/null
curl localhost:9898/samson/logging/debug.json               > json/error_logging_debug.json  2> /dev/null
curl localhost:9898/samson/logging/debug/onf.json           > json/error_logging_debug_onf.json  2> /dev/null
curl localhost:9898/samson/logging/reads.json               > json/error_logging_reads.json  2> /dev/null
curl localhost:9898/samson/logging/reads/onf.json           > json/error_logging_reads_onf.json  2> /dev/null
curl localhost:9898/samson/logging/writes.json              > json/error_logging_writes.json  2> /dev/null
curl localhost:9898/samson/logging/writes/onf.json          > json/error_logging_writes_onf.json  2> /dev/null
curl localhost:9898/samson/logging/trace.json               > json/error_logging_trace.json  2> /dev/null
curl localhost:9898/samson/logging/trace/onf.json           > json/error_logging_trace_onf.json  2> /dev/null
curl localhost:9898/samson/logging/trace/set/f.json         > json/error_logging_trace_set_f.json  2> /dev/null
curl localhost:9898/samson/logging/trace/set.json           > json/error_logging_trace_set.json  2> /dev/null
curl localhost:9898/samson/logging/trace/get/f.json         > json/error_logging_trace_get_f.json  2> /dev/null
curl localhost:9898/samson/logging/trace/add/f.json         > json/error_logging_trace_add_f.json  2> /dev/null
curl localhost:9898/samson/logging/trace/add.json           > json/error_logging_trace_add.json  2> /dev/null
curl localhost:9898/samson/logging/trace/remove/f.json      > json/error_logging_trace_remove_f.json  2> /dev/null
curl localhost:9898/samson/logging/trace/remove.json        > json/error_logging_trace_remove.json  2> /dev/null
curl localhost:9898/samson/logging/verbose/set.json         > json/error_logging_verbose_set.json  2> /dev/null
curl localhost:9898/samson/logging/verbose/add.json         > json/error_logging_verbose_set.json  2> /dev/null
curl localhost:9898/samson/logging/verbose/set/6.json       > json/error_logging_verbose_set_6.json  2> /dev/null


# JSON OK
curl localhost:9898/samson/version.json                     > json/version.json  2> /dev/null
curl localhost:9898/samson/cluster.json                     > json/cluster.json  2> /dev/null
curl localhost:9898/samson/state/quijote.count/Sancho.json  > json/state_quijote_Sancho.json  2> /dev/null
curl localhost:9898/samson/queue/quijote.count/Panza.json   > json/queue_quijote_Panza.json  2> /dev/null
curl localhost:9898/samson/logging/reads/on.json            > json/logging_reads_on.json  2> /dev/null
curl localhost:9898/samson/logging/reads/off.json           > json/logging_reads_off.json  2> /dev/null
curl localhost:9898/samson/logging/writes/on.json           > json/logging_writes_on.json  2> /dev/null
curl localhost:9898/samson/logging/writes/off.json          > json/logging_writes_off.json  2> /dev/null
curl localhost:9898/samson/logging/debug/on.json            > json/logging_debug_on.json  2> /dev/null
curl localhost:9898/samson/logging/debug/off.json           > json/logging_debug_off.json  2> /dev/null
curl localhost:9898/samson/logging/verbose/set/3.json       > json/logging_verbose_set_3.json  2> /dev/null
curl localhost:9898/samson/logging/verbose/get.json         > json/logging_verbose_get.json  2> /dev/null
curl localhost:9898/samson/logging/verbose/off.json         > json/logging_verbose_off.json  2> /dev/null
curl localhost:9898/samson/logging/verbose/get.json         > json/logging_verbose_get2.json  2> /dev/null
curl localhost:9898/samson/logging/trace/set/0-5,10-15.json > json/logging_trace_set_0-5,10-15.json  2> /dev/null
curl localhost:9898/samson/logging/trace/get.json           > json/logging_trace_get.json  2> /dev/null
curl localhost:9898/samson/logging/trace/add/25.json        > json/logging_trace_add_25.json  2> /dev/null
curl localhost:9898/samson/logging/trace/get.json           > json/logging_trace_get2.json  2> /dev/null
curl localhost:9898/samson/logging/trace/remove/3.json      > json/logging_trace_remove_3.json  2> /dev/null


# XML Errors:
curl localhost:9898/simpson.xml                             > xml/error_no_family.xml  2> /dev/null
curl localhost:9898/simpson/version.xml                     > xml/error_bad_family.xml  2> /dev/null
curl localhost:9898/samson/simpson.xml                      > xml/error_bad_command.xml  2> /dev/null
curl localhost:9898/simpson/version/34.xml                  > xml/error_version_34.xml  2> /dev/null
curl localhost:9898/samson/state/qnotfound/k.xml            > xml/error_state_not_found.xml  2> /dev/null
curl localhost:9898/samson/state/qnotfound.xml              > xml/error_state_no_key.xml  2> /dev/null
curl localhost:9898/samson/queue/qnotfound/k.xml            > xml/error_queue_not_found.xml  2> /dev/null
curl localhost:9898/samson/queue/qnotfound.xml              > xml/error_queue_no_key.xml  2> /dev/null
curl localhost:9898/samson/state/quijote.count/XXXXYZ.xml   > xml/state_quijote_XXXXYZ.xml  2> /dev/null
curl localhost:9898/samson/queue/quijote.count/XXXYZ.xml    > xml/queue_quijote_XXXXYZ.xml  2> /dev/null
curl localhost:9898/samson/logging.xml                      > xml/error_logging.xml  2> /dev/null
curl localhost:9898/samson/logging/xxx.xml                  > xml/error_logging_xxx.xml  2> /dev/null
curl localhost:9898/samson/logging/debug.xml                > xml/error_logging_debug.xml  2> /dev/null
curl localhost:9898/samson/logging/debug/onf.xml            > xml/error_logging_debug_onf.xml  2> /dev/null
curl localhost:9898/samson/logging/reads.xml                > xml/error_logging_reads.xml  2> /dev/null
curl localhost:9898/samson/logging/reads/onf.xml            > xml/error_logging_reads_onf.xml  2> /dev/null
curl localhost:9898/samson/logging/writes.xml               > xml/error_logging_writes.xml  2> /dev/null
curl localhost:9898/samson/logging/writes/onf.xml           > xml/error_logging_writes_onf.xml  2> /dev/null
curl localhost:9898/samson/logging/trace.xml                > xml/error_logging_trace.xml  2> /dev/null
curl localhost:9898/samson/logging/trace/onf.xml            > xml/error_logging_trace_onf.xml  2> /dev/null
curl localhost:9898/samson/logging/trace/set/f.xml          > xml/error_logging_trace_set_f.xml  2> /dev/null
curl localhost:9898/samson/logging/trace/set.xml            > xml/error_logging_trace_set.xml  2> /dev/null
curl localhost:9898/samson/logging/trace/get/f.xml          > xml/error_logging_trace_get_f.xml  2> /dev/null
curl localhost:9898/samson/logging/trace/add/f.xml          > xml/error_logging_trace_add_f.xml  2> /dev/null
curl localhost:9898/samson/logging/trace/add.xml            > xml/error_logging_trace_add.xml  2> /dev/null
curl localhost:9898/samson/logging/trace/remove/f.xml       > xml/error_logging_trace_remove_f.xml  2> /dev/null
curl localhost:9898/samson/logging/trace/remove.xml         > xml/error_logging_trace_remove.xml  2> /dev/null
curl localhost:9898/samson/logging/verbose/set.xml          > xml/error_logging_verbose_set.xml  2> /dev/null
curl localhost:9898/samson/logging/verbose/add.xml          > xml/error_logging_verbose_set.xml  2> /dev/null
curl localhost:9898/samson/logging/verbose/set/6.xml        > xml/error_logging_verbose_set_6.xml  2> /dev/null



# XML OK
curl localhost:9898/samson/version.xml                      > xml/version.xml  2> /dev/null
curl localhost:9898/samson/cluster.xml                      > xml/cluster.xml  2> /dev/null
curl localhost:9898/samson/state/quijote.count/Sancho.xml   > xml/state_quijote_Sancho.xml  2> /dev/null
curl localhost:9898/samson/queue/quijote.count/Panza.xml    > xml/queue_quijote_Panza.xml  2> /dev/null
curl localhost:9898/samson/logging/reads/on.xml             > xml/logging_reads_on.xml  2> /dev/null
curl localhost:9898/samson/logging/reads/off.xml            > xml/logging_reads_off.xml  2> /dev/null
curl localhost:9898/samson/logging/writes/on.xml            > xml/logging_writes_on.xml  2> /dev/null
curl localhost:9898/samson/logging/writes/off.xml           > xml/logging_writes_off.xml  2> /dev/null
curl localhost:9898/samson/logging/debug/on.xml             > xml/logging_debug_on.xml  2> /dev/null
curl localhost:9898/samson/logging/debug/off.xml            > xml/logging_debug_off.xml  2> /dev/null
curl localhost:9898/samson/logging/verbose/set/3.xml        > xml/logging_verbose_set_3.xml  2> /dev/null
curl localhost:9898/samson/logging/verbose/get.xml          > xml/logging_verbose_get.xml  2> /dev/null
curl localhost:9898/samson/logging/verbose/off.xml          > xml/logging_verbose_off.xml  2> /dev/null
curl localhost:9898/samson/logging/verbose/get.xml          > xml/logging_verbose_get2.xml  2> /dev/null
curl localhost:9898/samson/logging/trace/set/0-5,10-15.xml  > xml/logging_trace_set_0-5,10-15.xml  2> /dev/null
curl localhost:9898/samson/logging/trace/get.xml            > xml/logging_trace_get.xml  2> /dev/null
curl localhost:9898/samson/logging/trace/add/25.xml         > xml/logging_trace_add_25.xml  2> /dev/null
curl localhost:9898/samson/logging/trace/get.xml            > xml/logging_trace_get2.xml  2> /dev/null
curl localhost:9898/samson/logging/trace/remove/3.xml       > xml/logging_trace_remove_3.xml  2> /dev/null



#
# Kill worker
#
echo "all curl commands sent - now killing samsonWorker"
sleep .2
curl localhost:9898/samson/die.json  > json/die.json 2> /dev/null
sleep .2

#
# Is samsonWorker really dead?
#
curl localhost:9898/samson/version.json > json/should_be_empty.json 2> /dev/null
if [ "$?" == "0" ]
then
    echo samsonWorker doesn\'t seem to have died after sending it the DIE REST Request ...
    exit 2
fi


json_errors="error_bad_command.json \
error_bad_family.json \
error_logging.json \
error_logging_debug.json \
error_logging_debug_onf.json \
error_logging_reads.json \
error_logging_reads_onf.json \
error_logging_trace.json \
error_logging_trace_add.json \
error_logging_trace_add_f.json \
error_logging_trace_get_f.json \
error_logging_trace_onf.json \
error_logging_trace_remove.json \
error_logging_trace_remove_f.json \
error_logging_trace_set.json \
error_logging_trace_set_f.json \
error_logging_verbose_set.json \
error_logging_verbose_set_6.json \
error_logging_writes.json \
error_logging_writes_onf.json \
error_logging_xxx.json \
error_no_family.json \
error_queue_no_key.json \
error_queue_not_found.json \
error_state_no_key.json \
error_state_not_found.json \
error_version_34.json"

json_oks="cluster.json \
logging_debug_off.json \
logging_debug_on.json \
logging_reads_off.json \
logging_reads_on.json \
logging_trace_add_25.json \
logging_trace_get.json \
logging_trace_get2.json \
logging_trace_remove_3.json \
logging_trace_set_0-5,10-15.json \
logging_verbose_get.json \
logging_verbose_get2.json \
logging_verbose_off.json \
logging_verbose_set_3.json \
logging_writes_off.json \
logging_writes_on.json \
queue_quijote_Panza.json \
queue_quijote_XXXXYZ.json \
state_quijote_Sancho.json \
state_quijote_XXXXYZ.json \
version.json"


xml_errors="error_bad_command.xml \
error_bad_family.xml \
error_logging.xml \
error_logging_debug.xml \
error_logging_debug_onf.xml \
error_logging_reads.xml \
error_logging_reads_onf.xml \
error_logging_trace.xml \
error_logging_trace_add.xml \
error_logging_trace_add_f.xml \
error_logging_trace_get_f.xml \
error_logging_trace_onf.xml \
error_logging_trace_remove.xml \
error_logging_trace_remove_f.xml \
error_logging_trace_set.xml \
error_logging_trace_set_f.xml \
error_logging_verbose_set.xml \
error_logging_verbose_set_6.xml \
error_logging_writes.xml \
error_logging_writes_onf.xml \
error_logging_xxx.xml \
error_no_family.xml \
error_queue_no_key.xml \
error_queue_not_found.xml \
error_state_no_key.xml \
error_state_not_found.xml \
error_version_34.xml"

xml_oks="cluster.xml \
logging_debug_off.xml \
logging_debug_on.xml \
logging_reads_off.xml \
logging_reads_on.xml \
logging_trace_add_25.xml \
logging_trace_get.xml \
logging_trace_get2.xml \
logging_trace_remove_3.xml \
logging_trace_set_0-5,10-15.xml \
logging_verbose_get.xml \
logging_verbose_get2.xml \
logging_verbose_off.xml \
logging_verbose_set_3.xml \
logging_writes_off.xml \
logging_writes_on.xml \
queue_quijote_Panza.xml \
queue_quijote_XXXXYZ.xml \
state_quijote_Sancho.xml \
state_quijote_XXXXYZ.xml \
version.xml"

#
# Moving down to json
#
cd json



for js in $json_errors
do
    ../json_parser $js > /dev/null 2> /dev/null
   if [ "$?" != "0" ]
    then
        echo "Failure to parse " $js
        exit 3
    else
        echo OK: $js
    fi
done



for js in $json_oks
do
    ../json_parser $js > /dev/null 2>&1
    if [ "$?" != "0" ]
    then
        echo "Failure to parse " $js
        exit 4
    else
        echo OK: $js
    fi
done



#
# Moving up and down to xml
#
cd ../xml

for xml in $xml_errors
do
    xmllint $xml > /dev/null 2> /dev/null
    if [ "$?" != "0" ]
    then
        echo "Failure to parse " $xml
        exit 3
    else
        echo OK: $xml
    fi
done



for xml in $xml_oks
do
    xmllint $xml > /dev/null 2>&1
    if [ "$?" != "0" ]
    then
        echo "Failure to parse " $xml
        exit 4
    else
        echo OK: $xml
    fi
done
