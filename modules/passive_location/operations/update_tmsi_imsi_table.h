
/**
 File autogenerated with samsonModuleParser. Please, edit to complete this operation
*/

#ifndef _H_SAMSON_passive_location_update_tmsi_imsi_table
#define _H_SAMSON_passive_location_update_tmsi_imsi_table


#include <samson/module/samson.h>
#include <samson/modules/passive_location/CompleteTMSI.h>
#include <samson/modules/system/UInt.h>


namespace samson{
namespace passive_location{


	class update_tmsi_imsi_table : public samson::Reduce
	{

        samson::passive_location::CompleteTMSI completeTMSI;    // Input key
        samson::system::UInt newIMSI;                           // Input value of the records
        samson::system::UInt stateIMSI;                         // Input value of the state


	public:


//  INFO_MODULE
// If interface changes and you do not recreate this file, you will have to update this information (and of course, the module file)
// Please, do not remove this comments, as it will be used to check consistency on module declaration
//
//  input: passive_location.CompleteTMSI system.UInt  
//  input: passive_location.CompleteTMSI system.UInt  
//  output: passive_location.CompleteTMSI system.UInt
//  
// helpLine: Update the table to translate to recover imsi from tmsi
//  END_INFO_MODULE

		void init( samson::KVWriter *writer )
		{
		}

		void run( samson::KVSetStruct* inputs , samson::KVWriter *writer )
		{
            if (inputs[0].num_kvs == 0)
            {
                completeTMSI.parse(inputs[1].kvs[0]->key);
                stateIMSI.parse(inputs[1].kvs[0]->value);
                writer->emit( 0 , &completeTMSI , &stateIMSI );
                return;
            }

            completeTMSI.parse(inputs[0].kvs[0]->key);

            // Realmente no nos garantiza que sea el más reciente :(. Habría que incluir el timestamp
            newIMSI.parse(inputs[0].kvs[inputs[0].num_kvs-1]->value);

            writer->emit( 0 , &completeTMSI , &newIMSI );



		}

		void finish( samson::KVWriter *writer )
		{
		}



	};


} // end of namespace passive_location
} // end of namespace samson

#endif
