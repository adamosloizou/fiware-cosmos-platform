# Some cleaning
#rm /opt/samson/config/samsonPlatformProcesses
CONTROLLER_IP="localhost";
export CONTROLLER_IP
echo $CONTROLLER_IP

#./gensort -a 20000000 in.txt
# Running inside build/testing
#/usr/local/bin/samsonLocal -working . -f test_complete_commands.txt >test_complete_stdout 2>test_complete_stderr
if [ -n "${CONTROLLER_IP:+x}" ]; then
        echo "Environment variable CONTROLLER_IP defined to: " $CONTROLLER_IP > test_complete_stdout
        if [ $CONTROLLER_IP = "localhost" ]; then
                if ! ps -C samsonSpawner > /dev/null
                then
                        echo "Launching samsonSpawner" >> test_complete_stdout
                        samsonSpawner  >> test_complete_stdout &
                else
                        echo "samsonSpawner already running" >> test_complete_stdout
                fi
                sleep 3
        fi
	echo "delilah is starting..."
        /usr/local/bin/delilah -f test_complete_commands.txt >> test_complete_stdout 2> test_complete_stderr
else
        echo "Environment variable CONTROLLER_IP not defined, using samsonLocal" > test_complete_stdout
        /usr/local/bin/samsonLocal -working . -f test_complete_commands.txt >> test_complete_stdout 2> test_complete_stderr
fi

samsonCat out > out.txt
./valsort out.txt
